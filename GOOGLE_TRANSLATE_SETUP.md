# Google Cloud Translation API 設定ガイド

このガイドでは、Google Cloud Translation API を設定して、アプリでメッセージの自動翻訳機能を使用できるようにする手順を説明します。

## ステップ1: Google Cloud プロジェクトを作成

1. [Google Cloud Console](https://console.cloud.google.com/) にアクセス
2. Googleアカウントでログイン（まだアカウントがない場合は作成）
3. 右上の「プロジェクトを選択」をクリック
4. 「新しいプロジェクト」をクリック
5. プロジェクト名を入力（例: `happy-ice-cream-translate`）
6. 「作成」をクリック
7. 作成されたプロジェクトを選択

## ステップ2: Cloud Translation API を有効化

1. 左側のメニューから「APIとサービス」→「ライブラリ」を選択
2. 検索バーに「Cloud Translation API」と入力
3. 「Cloud Translation API」をクリック
4. 「有効にする」ボタンをクリック
5. 有効化が完了するまで数秒待つ

## ステップ3: 請求アカウントを設定（初回のみ）

1. 左側のメニューから「請求」を選択
2. 「請求アカウントをリンク」をクリック
3. 請求アカウントを作成（クレジットカード情報が必要）
   - **注意**: 無料枠（月間500,000文字）があるため、小規模な使用では料金がかからない可能性が高いです

## ステップ4: APIキーを作成

1. 左側のメニューから「APIとサービス」→「認証情報」を選択
2. 上部の「認証情報を作成」をクリック
3. 「APIキー」を選択
4. APIキーが作成される（自動的にコピーされる場合があります）
5. **重要**: 作成されたAPIキーをコピーして安全な場所に保存

## ステップ5: APIキーの制限を設定（推奨）

セキュリティのため、APIキーに制限を設定することをお勧めします。

1. 作成したAPIキーの右側にある「編集」アイコンをクリック
2. 「アプリケーションの制限」セクションで「HTTPリファラー（ウェブサイト）」を選択
3. 「ウェブサイトの制限」に以下を追加:
   ```
   https://your-domain.vercel.app/*
   https://*.vercel.app/*
   ```
   （`your-domain` を実際のVercelドメインに置き換えてください）
4. 「APIの制限」セクションで「キーを制限」を選択
5. 「Cloud Translation API」にチェックを入れる
6. 「保存」をクリック

## ステップ6: 環境変数を設定

### ローカル開発環境

1. プロジェクトのルートディレクトリに `.env.local` ファイルを作成（既にある場合は編集）
2. 以下の行を追加:
   ```bash
   GOOGLE_TRANSLATE_API_KEY=your_api_key_here
   ```
   （`your_api_key_here` をステップ4でコピーしたAPIキーに置き換えてください）

3. ファイルを保存

### Vercel（本番環境）

1. [Vercel Dashboard](https://vercel.com/dashboard) にアクセス
2. プロジェクトを選択
3. 「Settings」タブをクリック
4. 左側のメニューから「Environment Variables」を選択
5. 「Add New」をクリック
6. 以下の情報を入力:
   - **Key**: `GOOGLE_TRANSLATE_API_KEY`
   - **Value**: ステップ4でコピーしたAPIキー
   - **Environment**: すべての環境（Production, Preview, Development）にチェック
7. 「Save」をクリック
8. **重要**: 環境変数を追加した後、再デプロイが必要な場合があります

## ステップ7: 動作確認

1. アプリを起動（ローカル開発の場合: `npm run dev`）
2. メイン画面で「Happy Ice Cream」ロゴをタップして言語を英語に切り替え
3. メッセージが英語に翻訳されているか確認
4. ブラウザの開発者ツール（F12）のコンソールでエラーがないか確認

## 料金について

### 無料枠
- **月間500,000文字まで無料**
- 多くのアプリケーションでは、この無料枠で十分です

### 超過時の料金
- 100万文字あたり **$20**
- 例: 月間100万文字使用 = $20

### 使用量の確認方法
1. Google Cloud Console → 「APIとサービス」→「ダッシュボード」
2. 「Cloud Translation API」を選択
3. 使用量と料金を確認

## トラブルシューティング

### APIキーが認識されない場合

1. 環境変数が正しく設定されているか確認
2. `.env.local` ファイルが `.gitignore` に含まれているか確認（セキュリティのため）
3. Vercelの環境変数が正しく設定されているか確認
4. アプリを再起動（環境変数の変更は再起動が必要な場合があります）

### 「APIキーが無効です」エラーが出る場合

1. APIキーが正しくコピーされているか確認（余分なスペースや改行がないか）
2. Cloud Translation API が有効になっているか確認
3. APIキーの制限設定を確認（ステップ5）

### 翻訳が動作しない場合

1. ブラウザのコンソールでエラーログを確認
2. Vercelのログ（Functions タブ）でエラーを確認
3. APIキーの使用制限（無料枠の超過など）を確認
4. Google Cloud Console でAPIの使用状況を確認

## セキュリティのベストプラクティス

1. **APIキーをGitにコミットしない**
   - `.env.local` は必ず `.gitignore` に含める
   - APIキーをコードに直接書かない

2. **APIキーに制限を設定する**
   - ステップ5で説明したように、HTTPリファラーとAPIの制限を設定

3. **定期的にAPIキーをローテーション**
   - 定期的に新しいAPIキーを作成し、古いキーを削除

4. **使用量を監視**
   - Google Cloud Console で使用量を定期的に確認
   - 異常な使用量がないかチェック

## 次のステップ

APIキーを設定したら、アプリを再デプロイして翻訳機能をテストしてください。問題があれば、上記のトラブルシューティングを参照してください。

